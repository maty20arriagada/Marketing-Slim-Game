<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MKT SLIM GAME — Acceso Profesor</title>
    <meta name="description" content="Panel de acceso para profesores del Simulador MKT SLIM GAME B2B.">
    <link rel="stylesheet" href="css/design-system.css">
    <script src="js/theme-toggle.js"></script>
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .login-container {
            text-align: center;
            max-width: 420px;
            width: 100%;
            padding: 40px 24px;
            animation: fadeInUp 0.6s ease forwards;
        }

        .login-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, #F59E0B, #D97706);
            border-radius: 20px;
            font-size: 2rem;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(245, 158, 11, 0.35);
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 800;
            letter-spacing: -1px;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .login-subtitle {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 32px;
        }

        .login-card {
            background: var(--bg-surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 32px 28px;
            text-align: left;
        }

        .login-card .form-group {
            margin-bottom: 20px;
        }

        .login-card .form-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            letter-spacing: 0.5px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .login-card .form-input {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border-bright);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 1rem;
            padding: 12px 14px;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .login-card .form-input:focus {
            border-color: var(--accent-amber);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.12);
        }

        .login-error {
            display: none;
            padding: 10px 14px;
            background: rgba(244, 63, 94, 0.08);
            border: 1px solid rgba(244, 63, 94, 0.25);
            border-radius: var(--radius-sm);
            font-size: 0.82rem;
            color: var(--accent-rose);
            margin-bottom: 16px;
            animation: fadeInUp 0.3s ease forwards;
        }

        .login-error.visible {
            display: block;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent-amber);
            color: #0A0C14;
            font-size: 0.95rem;
            font-weight: 700;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .login-btn:hover {
            background: #D97706;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.35);
            transform: translateY(-1px);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-footer {
            margin-top: 24px;
            font-size: 0.75rem;
            color: var(--text-dim);
            text-align: center;
        }

        .login-footer a {
            color: var(--text-muted);
            text-decoration: none;
        }

        .login-footer a:hover {
            color: var(--accent-blue);
        }

        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 12px;
            border-radius: 99px;
            border: 1px solid rgba(16, 185, 129, 0.3);
            font-size: 0.72rem;
            font-weight: 600;
            color: var(--accent-emerald);
            background: rgba(16, 185, 129, 0.08);
            margin-bottom: 28px;
        }

        /* Background grid */
        .bg-grid {
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(245, 158, 11, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(245, 158, 11, 0.02) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 0;
        }

        .login-container {
            position: relative;
            z-index: 1;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Lock icon animation */
        @keyframes unlockShake {

            0%,
            100% {
                transform: rotate(0);
            }

            25% {
                transform: rotate(-8deg);
            }

            75% {
                transform: rotate(8deg);
            }
        }

        .login-icon.shake {
            animation: unlockShake 0.4s ease;
        }
    </style>
</head>

<body>
    <div class="bg-grid"></div>

    <div class="login-container">
        <div class="login-icon" id="login-icon">🔒</div>
        <h1 class="login-title">Acceso Profesor</h1>
        <p class="login-subtitle">Panel de administración del Simulador MKT SLIM GAME</p>

        <div class="security-badge">🛡️ Sesión protegida con cifrado de servidor</div>

        <div class="login-card">
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label" for="password-input">Contraseña del Panel</label>
                    <input type="password" id="password-input" class="form-input" placeholder="Ingresa la contraseña"
                        autocomplete="current-password" required>
                </div>

                <div class="login-error" id="login-error">
                    ❌ Contraseña incorrecta. Verifica con el administrador del curso.
                </div>

                <button type="submit" class="login-btn" id="login-btn">
                    🔓 Ingresar al Panel
                </button>
            </form>
        </div>

        <div class="login-footer">
            <a href="index.html">← Volver al inicio</a> ·
            Solo personal autorizado
        </div>
    </div>

    <script>
        async function handleLogin(e) {
            e.preventDefault();

            const btn = document.getElementById('login-btn');
            const errorEl = document.getElementById('login-error');
            const iconEl = document.getElementById('login-icon');
            const password = document.getElementById('password-input').value;

            // Deshabilitar botón para evitar spam
            btn.disabled = true;
            btn.textContent = '⏳ Verificando...';
            errorEl.classList.remove('visible');

            try {
                const res = await fetch('/api/professor-login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password }),
                });

                const data = await res.json();

                if (data.success) {
                    // Éxito: cambiar icono y redirigir
                    iconEl.textContent = '🔓';
                    iconEl.style.background = 'linear-gradient(135deg, #10B981, #059669)';
                    btn.textContent = '✅ Acceso concedido';
                    btn.style.background = 'var(--accent-emerald)';

                    setTimeout(() => {
                        window.location.href = data.redirect || '/professor-panel';
                    }, 600);
                } else {
                    // Error: mostrar feedback
                    errorEl.classList.add('visible');
                    iconEl.classList.add('shake');
                    setTimeout(() => iconEl.classList.remove('shake'), 500);

                    btn.disabled = false;
                    btn.textContent = '🔓 Ingresar al Panel';
                    document.getElementById('password-input').value = '';
                    document.getElementById('password-input').focus();
                }
            } catch (err) {
                errorEl.textContent = '⚠️ Error de conexión con el servidor. Asegúrate de acceder vía http://localhost:3000';
                errorEl.classList.add('visible');
                btn.disabled = false;
                btn.textContent = '🔓 Ingresar al Panel';
            }
        }

        // Focus automático en el campo de contraseña
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('password-input').focus();
        });
    </script>
</body>

</html>